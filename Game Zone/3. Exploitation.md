Now that we have initial access, we will examine the sockets running on the target machine. We use the command `ss -tulpn` to determine what socket connections are running.

<center>

![df9519e4b3c196b3e4f105e8425fe0f4.png](/Game Zone/_resources/df9519e4b3c196b3e4f105e8425fe0f4-1.png)

![437af3e5986988fec43aeaf29188933d.png](/Game Zone/_resources/437af3e5986988fec43aeaf29188933d-1.png)

</center>

From the above output, we see that there is a service running on port 10000 which is presumably blocked by a firewall rule (as it didn't show up in our nmap scans). We can try using `cat /etc/iptables/rules.v4`, but our current user doesn't have access.

To bypass the firewall, we use [reverse SSH port forwarding](https://blog.devolutions.net/2017/03/what-is-reverse-ssh-port-forwarding/). This technique allows us to "forward" a port on the target system to a port on the local system. In this case, we wish to forward the blocked port to a port on the local machine which we can then access. The command to use here is `ssh -L <local port>:localhost:<blocked port> <username>@<ip>`. The `-L` switch specifies local tunnel mode, in which we forward traffic from the client to our own server. (Using `-R` instead does the opposite, where we forward traffic to the client.)

Specifying all parameters, the command is `ssh -L 9999:localhost:10000 -f -N agent47@10.10.63.128`. We run this command on the attacking machine. Navigating to `localhost:10000` gives us access to the newly-exposed web server.

**Note:** Following the suggestion of another write-up, I had to add in the `-f` and `-N` switches, since the command given by the exercise didn't seem to work for me. An explanation of these switches is given by explainshell; I've included the relevant snippets below.

|     |     |
| --- | --- |
| -f  | Requests **ssh** to go to background just before command execution. This is useful if **ssh** is going to ask for passwords or passphrases, but the user wants it in the background. |
| -N  | Do not execute a remote command. This is useful for just forwarding ports. |

Navigating to `localhost:9999` shows us that we've successfully forwarded port 10000 on the target machine to our port 9999.

<center>

![7bde271f26f183e4a55c763fc2e6f1b1.png](/Game Zone/_resources/7bde271f26f183e4a55c763fc2e6f1b1-1.png)

</center>

Running nmap against this port with the standard loopback address of `127.0.0.1` gives us some more information about the service running on this port. This also reveals the version number of the CMS, which we will need later.

<center>

![46776e313aeb93b9a6af2f01d21235f0.png](/Game Zone/_resources/46776e313aeb93b9a6af2f01d21235f0-1.png)

</center>

Alternatively, we can log in to the CMS using the credentials we found earlier.

<center>

![c306f5c824a3328468197f69d6d26b0c.png](/Game Zone/_resources/c306f5c824a3328468197f69d6d26b0c-1.png)

</center>